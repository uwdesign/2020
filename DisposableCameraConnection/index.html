<!-- Thipok Cholsaipant 10.59-->
<html xmlns="http://www.w3.org/1999/xhtml">
<meta charset="UTF-8">

<head>
    <style>
        html {
            overflow-x: scroll;
            overflow-y: hidden;
        }

        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }

        .item {
            float: left;
            position: relative;
            line-height: 1em;
            /* opacity: 0; */
        }

        .grid-sizer {
            width: 45vh;
        }

        .item {
            width: calc(45vh - 24px);
            margin-bottom: 24px;
            /* transition: opacity .5s cubic-bezier(.55,.055,.675,.19) !important; */
            transition-timing-function: cubic-bezier(0.785, 0.135, 0.150, 0.860);

            /* margin: 12px; */
        }

        .item:hover img {
            opacity: 0.15;
        }

        .item img {
            transition: opacity .3s;
            transition-timing-function: cubic-bezier(.55, .055, .675, .19);
        }

        .image {
            max-width: 100%;
            margin: 0;
            display: block;
            object-fit: cover;
        }

        .image:after {
            clear: both;
        }

        .overlay {
            /* width: 100%; */
            /* height: 100%; */
            position: absolute;
            bottom: 0;
            left: 0;
            text-decoration: none;
            color: #000cee;

            transform-origin: bottom left;
            transform: rotate3d(0, 0, 1, 90deg) translate3d(-100%, 0, 0);
            opacity: 0;
            transition: opacity .3s;
            transition-timing-function: cubic-bezier(1.000, 0.000, 0.000, 1.000);
            /* Note: for a CLOCKWISE rotation, use the commented-out
            transform instead of this one. */
            /* Use 3d tranform or opengl performance */
            /* transform: rotate(90deg) translate(0, -100%) */
        }

        .item:hover .overlay {
            display: block;
            opacity: 1;
        }

        #loadMore {
            position: fixed;
            top: 0px;
            left: 0px;
        }

        #bodycontent {
            width: 95vh;
            padding-top: 24px;
            padding-left: 24px;
            padding-bottom: 25vw;
            transform-origin: top left;
            /* transform: rotate(-90deg) translate(-100vh, 0%); */
            /* Use 3d tranform or opengl performance */
            transform: rotate3d(0, 0, 1, -90deg) translate3d(-100%, 0%, 0);
        }

        #rotatecontainer {
            height: 100vh;
            overflow-y: hidden;
            margin: 0;
        }

        #container {
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
        }

        /* .item .new {
            transform: translateY(50px);
            transition: opacity .5s cubic-bezier(.55,.055,.675,.19);
            opacity: 0;
        }
        .item {
            transform: translateY(0px);
            opacity: 1;
        } */
    </style>
</head>

<body>
    <div id="rotatecontainer">
        <div id="bodycontent">
            <div id="container">
                <div class="grid-sizer">
                </div>
            </div>
        </div>
    </div>



    <button id="loadMore" type="button">Load more</button>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.0.0/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.js"></script>
    <script>
        const $uwdimg = "https://images.uwdesignshow.com/?"
        const imgquery = "ro=90&af&il&auth=uw"
        const urlpath = "https://gh.uwdesignshow.com/2020/DisposableCameraConnection/"
        const itemsCount = 5
        var fetching = 0
        //
        // When jquery is ready
        $(document).ready(function () {
            function getUrlVars() {
                var vars = [],
                    hash;
                var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < hashes.length; i++) {
                    hash = hashes[i].split('=');
                    vars.push(hash[0]);
                    vars[hash[0]] = hash[1];
                }
                return vars;
            }

            const urlParams = getUrlVars();

            var json = {}

            var hiddenItems = {}
            var addedItems = []

            $container = $('#container')

            $.getJSON(urlpath + "data/" + urlParams["data"],
                function (data) {
                    console.log(this)
                    json = data
                    hiddenItems = data.images
                });

            $container.masonry({
                itemSelector: ".item",
                columnWidth: ".grid-sizer",
                hiddenStyle: {
                    transform: 'translateY(100px)',
                    opacity: 0
                },
                visibleStyle: {
                    transform: 'translateY(0px)',
                    opacity: 1
                },
                stagger: 30,
                // gutter: "12",
                // transitionDuration: "1"
            });

            // $container.infiniteScroll({
            //     append: false, // disable automatic appending
            // });



            function srcSet(url, sizes) {
                var srcSetString = "";
                sizes.forEach(function (elem) {
                    // srcSetString += ($uwdimg + imgquery + "&w=" + elem + "&url=" + url);
                    srcSetString += ($uwdimg + imgquery + "&w=" + elem + "&url=" + url);
                    srcSetString += (" " + (elem * 2) + "w, ");
                })
                return srcSetString;
            }

            function generateItem(itemData) {
                var src = urlpath + itemData.src.substring('2')
                return '<div class="item new"><img srcset="' +
                    srcSet(src, [100, 300, 500, 750, 1000, 1500]) +
                    '" class="image"><a class="overlay" href="https://www.uwdesignshow.com/students/' + itemData
                    .slug + '">' + itemData.name + 'â€”' + itemData.program + '</a></div>';
            }

            function addItemFrom() {
                var elems = []
                console.log(hiddenItems)
                for (var i = itemsCount - 1; i >= 0; i--) {
                    if (hiddenItems.length > 0) {
                        var item = hiddenItems.splice(Math.floor(Math.random() * hiddenItems.length), 1);
                        console.log(item)
                        $item = $(generateItem(item[0]))
                        elems.push($item);
                        addedItems.push([item, $item]);
                    } else {
                        break;
                    }
                }

                //                 console.log($elems)
                $('#container').append(elems)
                $('#container').find('items').filter('.new').hide();
                $('#container').find('img').on('load', (event) => {
                    var $img = event.target
                    var $item = $($img.parentElement);

                    $item.removeClass('new');
                    $item.show();
                    $('#container').masonry('appended', $item);
                    // layout
                    $('#container').masonry();
                    $('#loadMore').show()
                    fetching--;
                })
                // $('#container').masonryImagesReveal($('#container').find('.item'))

            }

            $('#loadMore').click(function () {
                $(this).hide();
                addItemFrom();
            });

            $(window).scroll(function () {
                // End of the document reached?
                console.log($(document).width() - $(window).width() == $(window).scrollLeft());
                if ($(document).width() - $(window).width() == $(window).scrollLeft()) {
                    console.log('ya')
                    if (fetching <= 0) {
                        fetching += itemsCount;
                        $('#loadMore').click();
                        // time out refetch
                        setTimeout(() => {
                            fetching = 0;
                        }, 2000)
                    }

                }
            });

            // $('#loadMore').click();
            // $('#loadMore').click();
        });
    </script>
</body>

</html>